---
indicator:     submit
auto_fieldset: { legend: 'Hospitalisation' }
auto_constraint_class: %t
render_method: tt

elements:

  - type: Hidden
    name: patient_id

  - type: Text
    name: date
    label: Hospitalisation Date
    constraints:
      - Required
      - type: DateTime
        parser: &PARSER
          strptime: '%Y-%m-%d'
      - type: Length
        max:  10
        min:  1
      - type:    DBIC::Unique
        model:   DB::Hospitalisation
        myself:  object
        message: This hospitalisation already exists
        others:  patient_id
    inflators:
      - type: DateTime
        parser: *PARSER
        strptime: '%Y-%m-%d'
    label_attributes:
      tooltipText: The date of the hospitalisation event; click on the entry box for a pop-up calendar.

  - type: Text
    name: days_duration
    label: Total IP days
    constraints:
      - Integer
      - type: Length
        max:  4
        min:  0
    label_attributes:
      tooltipText: Total length of stay in hospital (in days).

  - type: Text
    name: postop_days_duration
    label: IP days 0-3/12 not inc TX
    constraints:
      - Integer
      - type: Length
        max:  4
        min:  0
      - type: DependOn
        others: days_duration
    label_attributes:
      tooltipText: Total post-operative length of stay in hospital (in days).

  - type: Text
    name: reason_for_admission
    label: Reason for admission
    constraints:
      - ASCII
      - type: Length
        max:  255
        min:  0
    label_attributes:
      tooltipText: Reason for admission to hospital.

  - type: Submit
    name: submit
    value: Submit Form

constraints:
  - SingleValue

